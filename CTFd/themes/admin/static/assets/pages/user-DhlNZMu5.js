import{$ as e,A as y,B as v,u,C as l,z as g,R as d}from"./main-DvY3K8eO.js";import{c as p,u as m}from"../graphs-D7_mhAOs.js";import{C as b}from"../CommentBox-DAFh8Ri2.js";import"../echarts.common-DqHxtDez.js";function _(n){n.preventDefault();const s=e("#user-info-create-form").serializeJSON(!0);s.fields=[];for(const o in s)if(o.match(/fields\[\d+\]/)){let a={},r=parseInt(o.slice(7,-1));a.field_id=r,a.value=s[o],s.fields.push(a),delete s[o]}let t="/api/v1/users";s.notify===!0&&(t=`${t}?notify=true`),delete s.notify,l.fetch(t,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(o){return o.json()}).then(function(o){if(o.success){const a=o.data.id;window.location=l.config.urlRoot+"/admin/users/"+a}else e("#user-info-create-form > #results").empty(),Object.keys(o.errors).forEach(function(a,r){e("#user-info-create-form > #results").append(d({type:"error",body:o.errors[a]}));const c=e("#user-info-form").find("input[name={0}]".format(a)),f=e(c);f.addClass("input-filled-invalid"),f.removeClass("input-filled-valid")})})}function S(n){n.preventDefault();const s=e("#user-info-edit-form").serializeJSON(!0);s.fields=[];for(const t in s)if(t.match(/fields\[\d+\]/)){let i={},o=parseInt(t.slice(7,-1));i.field_id=o,i.value=s[t],s.fields.push(i),delete s[t]}l.fetch("/api/v1/users/"+window.USER_ID,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(t){return t.json()}).then(function(t){t.success?window.location.reload():(e("#user-info-edit-form > #results").empty(),Object.keys(t.errors).forEach(function(i,o){e("#user-info-edit-form > #results").append(d({type:"error",body:t.errors[i]}));const a=e("#user-info-edit-form").find("input[name={0}]".format(i)),r=e(a);r.addClass("input-filled-invalid"),r.removeClass("input-filled-valid")}))})}function C(n){n.preventDefault(),u({title:"Delete User",body:"Are you sure you want to delete {0}".format("<strong>"+g(window.USER_NAME)+"</strong>"),success:function(){l.fetch("/api/v1/users/"+window.USER_ID,{method:"DELETE"}).then(function(s){return s.json()}).then(function(s){s.success&&(window.location=l.config.urlRoot+"/admin/users")})}})}function E(n){n.preventDefault();const s=e("#user-award-form").serializeJSON(!0);s.user_id=window.USER_ID,l.fetch("/api/v1/awards",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(t){return t.json()}).then(function(t){t.success?window.location.reload():(e("#user-award-form > #results").empty(),Object.keys(t.errors).forEach(function(i,o){e("#user-award-form > #results").append(d({type:"error",body:t.errors[i]}));const a=e("#user-award-form").find("input[name={0}]".format(i)),r=e(a);r.addClass("input-filled-invalid"),r.removeClass("input-filled-valid")}))})}function k(n){n.preventDefault();var s=e("#user-mail-form").serializeJSON(!0);l.fetch("/api/v1/users/"+window.USER_ID+"/email",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(t){return t.json()}).then(function(t){t.success?(e("#user-mail-form > #results").append(d({type:"success",body:"E-Mail sent successfully!"})),e("#user-mail-form").find("input[type=text], textarea").val("")):(e("#user-mail-form > #results").empty(),Object.keys(t.errors).forEach(function(i,o){e("#user-mail-form > #results").append(d({type:"error",body:t.errors[i]}));var a=e("#user-mail-form").find("input[name={0}], textarea[name={0}]".format(i)),r=e(a);r.addClass("input-filled-invalid"),r.removeClass("input-filled-valid")}))})}function D(n){let t=e("input[data-submission-type=incorrect]:checked").map(function(){return e(this).data("submission-id")}),i=t.length===1?"submission":"submissions";u({title:"Correct Submissions",body:`Are you sure you want to mark ${t.length} ${i} correct?`,success:function(){const o=[];for(var a of t){let r=l.fetch(`/api/v1/submissions/${a}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({type:"correct"})});o.push(r)}Promise.all(o).then(r=>{window.location.reload()})}})}function h(n,s){let t,i,o;switch(s){case"solves":t=e("input[data-submission-type=correct]:checked"),i="solve",o="Solves";break;case"fails":t=e("input[data-submission-type=incorrect]:checked"),i="fail",o="Fails";break}let a=t.map(function(){return e(this).data("submission-id")}),r=a.length===1?i:i+"s";u({title:`Delete ${o}`,body:`Are you sure you want to delete ${a.length} ${r}?`,success:function(){const c=[];for(var f of a)c.push(l.api.delete_submission({submissionId:f}));Promise.all(c).then(T=>{window.location.reload()})}})}function A(n){let s=e("input[data-award-id]:checked").map(function(){return e(this).data("award-id")}),t=s.length===1?"award":"awards";u({title:"Delete Awards",body:`Are you sure you want to delete ${s.length} ${t}?`,success:function(){const i=[];for(var o of s){let a=l.fetch("/api/v1/awards/"+o,{method:"DELETE",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}});i.push(a)}Promise.all(i).then(a=>{window.location.reload()})}})}function I(n){n.preventDefault();let s=e("input[data-missing-challenge-id]:checked").map(function(){return e(this).data("missing-challenge-id")}),t=s.length===1?"challenge":"challenges";u({title:"Mark Correct",body:`Are you sure you want to mark ${s.length} ${t} correct for ${g(window.USER_NAME)}?`,success:function(){const i=[];for(var o of s){let a={provided:"MARKED AS SOLVED BY ADMIN",user_id:window.USER_ID,team_id:window.TEAM_ID,challenge_id:o,type:"correct"},r=l.fetch("/api/v1/submissions",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)});i.push(r)}Promise.all(i).then(a=>{window.location.reload()})}})}const w={team:[n=>l.api.get_team_solves({teamId:n}),n=>l.api.get_team_fails({teamId:n}),n=>l.api.get_team_awards({teamId:n})],user:[n=>l.api.get_user_solves({userId:n}),n=>l.api.get_user_fails({userId:n}),n=>l.api.get_user_awards({userId:n})]},j=(n,s,t,i)=>{let[o,a,r]=w[n];Promise.all([o(i),a(i),r(i)]).then(c=>{p("score_graph","#score-graph",c,n,s,t,i),p("category_breakdown","#categories-pie-graph",c,n,s,t,i),p("solve_percentages","#keys-pie-graph",c,n,s,t,i)})},O=(n,s,t,i)=>{let[o,a,r]=w[n];Promise.all([o(i),a(i),r(i)]).then(c=>{m("score_graph","#score-graph",c,n,s,t,i),m("category_breakdown","#categories-pie-graph",c,n,s,t,i),m("solve_percentages","#keys-pie-graph",c,n,s,t,i)})};e(()=>{e(".delete-user").click(C),e(".edit-user").click(function(r){e("#user-info-modal").modal("toggle")}),e(".award-user").click(function(r){e("#user-award-modal").modal("toggle")}),e(".email-user").click(function(r){e("#user-email-modal").modal("toggle")}),e(".addresses-user").click(function(r){e("#user-addresses-modal").modal("toggle")}),e("#user-mail-form").submit(k),e("#solves-delete-button").click(function(r){h(r,"solves")}),e("#correct-fail-button").click(D),e("#fails-delete-button").click(function(r){h(r,"fails")}),e("#awards-delete-button").click(function(r){A()}),e("#missing-solve-button").click(function(r){I(r)}),e("#user-info-create-form").submit(_),e("#user-info-edit-form").submit(S),e("#user-award-form").submit(E);let n=document.createElement("div");document.querySelector("#comment-box").appendChild(n),y({render:()=>v(b,{type:"user",id:window.USER_ID})}).mount(n);let s,t,i,o;({type:s,id:t,name:i,account_id:o}=window.stats_data);let a;e("#user-statistics-modal").on("shown.bs.modal",function(r){j(s,t,i,o),a=setInterval(()=>{O(s,t,i,o)},3e5)}),e("#user-statistics-modal").on("hidden.bs.modal",function(r){clearInterval(a)}),e(".statistics-user").click(function(r){e("#user-statistics-modal").modal("toggle")})});
