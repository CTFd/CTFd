import{_,c,o as d,a as t,w as f,v as F,b as S,C as a,d as T,e as N,f as D,r as L,g as k,h as w,F as v,i as b,t as p,$ as r,j as z,k as g,l as j,T as P,m as H,p as U,n as J,q as E,s as M,u as x,x as V,y as B,z as K,A as y,B as C,D as Y,E as I,G as Q}from"./main-DvY3K8eO.js";import"../tab-CCbbAUQo.js";import{C as Z}from"../CommentBox-DAFh8Ri2.js";const W={name:"StaticFlagForm",props:{challenge_id:Number,mode:{type:String,default:"create"},initialData:{type:Object,default:()=>({})}},data(){return{flag:this.initialData.content||"",data:this.initialData.data||""}},methods:{submit(){const e={type:"static",content:this.flag,data:this.data};this.challenge_id&&(e.challenge=this.challenge_id),this.mode==="edit"&&(e.id=this.initialData.id),this.$emit("submit",e)}}},X={class:"form-group"},ee=t("label",{for:"static-flag"},"Flag",-1),te={class:"form-group"},se=t("label",{for:"static-data"},"Data (optional)",-1);function ne(e,s,l,u,o,i){return d(),c("div",null,[t("div",X,[ee,f(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>o.flag=n),type:"text",class:"form-control",id:"static-flag",name:"flag",required:""},null,512),[[F,o.flag]])]),t("div",te,[se,f(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>o.data=n),type:"text",class:"form-control",id:"static-data",name:"data"},null,512),[[F,o.data]])]),t("button",{class:"btn btn-success float-right",onClick:s[2]||(s[2]=(...n)=>i.submit&&i.submit(...n))}," Create Flag ")])}const O=_(W,[["render",ne]]),ie={name:"RegexFlagForm",props:{challenge_id:{type:Number,default:null},mode:{type:String,default:"create"},initialData:{type:Object,default:()=>({})}},data(){return{flag:this.initialData.content||"",data:this.initialData.data||"true"}},methods:{submit(){const e={type:"regex",content:this.flag,data:this.data};this.challenge_id&&(e.challenge=this.challenge_id),this.mode==="edit"&&this.initialData.id&&(e.id=this.initialData.id),this.$emit("submit",e)}}},le={class:"form-group"},oe=t("label",{for:"regex-flag"},"Regular Expression",-1),ae={class:"form-group"},de=t("label",{for:"regex-data"},"Case Sensitive",-1),ce=t("option",{value:"true"},"Yes",-1),re=t("option",{value:"false"},"No",-1),ue=[ce,re];function he(e,s,l,u,o,i){return d(),c("div",null,[t("div",le,[oe,f(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>o.flag=n),type:"text",class:"form-control",id:"regex-flag",name:"flag",placeholder:"e.g. ^CTF\\{[a-zA-Z0-9]+\\}$",required:""},null,512),[[F,o.flag]])]),t("div",ae,[de,f(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>o.data=n),class:"form-control custom-select",id:"regex-data",name:"data"},ue,512),[[S,o.data]])]),t("button",{class:"btn btn-success float-right",onClick:s[2]||(s[2]=(...n)=>i.submit&&i.submit(...n))}," Create Flag ")])}const G=_(ie,[["render",he]]),me={name:"FlagCreationForm",props:{challenge_id:Number},components:{StaticFlagForm:O,RegexFlagForm:G},data(){return{selectedType:""}},computed:{selectedTypeComponent(){switch(this.selectedType){case"static":return"StaticFlagForm";case"regex":return"RegexFlagForm";default:return null}}},methods:{submitFlag(e){a.fetch("/api/v1/flags",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(s=>s.json()).then(s=>{this.$emit("refreshFlags",this.$options.name)})}}},pe={id:"flag-create-modal",class:"modal fade",tabindex:"-1"},fe={class:"modal-dialog modal-lg"},ge={class:"modal-content"},_e=T('<div class="modal-header text-center"><div class="container"><div class="row"><div class="col-md-12"><h3>Create Flag</h3></div></div></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>',1),ve={class:"modal-body"},be=t("label",{for:"create-keys-select",class:"control-label"}," Choose Flag Type ",-1),$e=t("option",{disabled:"",value:""},"--",-1),ye=t("option",{value:"static"},"static",-1),Ce=t("option",{value:"regex"},"regex",-1),Fe=[$e,ye,Ce],Te=t("br",null,null,-1);function we(e,s,l,u,o,i){return d(),c("div",pe,[t("div",fe,[t("div",ge,[_e,t("div",ve,[be,f(t("select",{class:"form-control custom-select","onUpdate:modelValue":s[0]||(s[0]=n=>o.selectedType=n)},Fe,512),[[S,o.selectedType]]),Te,i.selectedTypeComponent?(d(),N(L(i.selectedTypeComponent),{key:0,challenge_id:l.challenge_id,onSubmit:i.submitFlag},null,40,["challenge_id","onSubmit"])):D("",!0)])])])])}const He=_(me,[["render",we]]),Ee={name:"FlagEditForm",props:{flag_id:Number},components:{StaticFlagForm:O,RegexFlagForm:G},data(){return{flag:null}},computed:{selectedTypeComponent(){if(!this.flag)return null;switch(this.flag.type){case"static":return"StaticFlagForm";case"regex":return"RegexFlagForm";default:return null}}},watch:{flag_id:{immediate:!0,handler(e){e!==null&&this.loadFlag()}}},methods:{loadFlag(){a.fetch(`/api/v1/flags/${this.flag_id}`,{method:"GET"}).then(e=>e.json()).then(e=>{this.flag=e.data})},updateFlag(e){a.fetch(`/api/v1/flags/${this.flag_id}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(s=>s.json()).then(s=>{this.$emit("refreshFlags",this.$options.name)})}}},ke={id:"flag-edit-modal",class:"modal fade",tabindex:"-1"},je={class:"modal-dialog modal-lg"},xe={class:"modal-content"},Se=T('<div class="modal-header text-center"><div class="container"><div class="row"><div class="col-md-12"><h3>Edit Flag</h3></div></div></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>',1),qe={class:"modal-body"};function Ae(e,s,l,u,o,i){return d(),c("div",ke,[t("div",je,[t("div",xe,[Se,t("div",qe,[o.flag&&i.selectedTypeComponent?(d(),N(L(i.selectedTypeComponent),{key:0,mode:"edit",initialData:o.flag,onSubmit:i.updateFlag},null,40,["initialData","onSubmit"])):D("",!0)])])])])}const Re=_(Ee,[["render",Ae]]),Ne={components:{FlagCreationForm:He,FlagEditForm:Re},props:{challenge_id:Number},data:function(){return{flags:[],editing_flag_id:null}},methods:{loadFlags:function(){a.fetch(`/api/v1/challenges/${this.$props.challenge_id}/flags`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success&&(this.flags=e.data)})},refreshFlags(e){this.loadFlags();let s;switch(e){case"FlagEditForm":s=this.$refs.FlagEditForm.$el,r(s).modal("hide");break;case"FlagCreationForm":s=this.$refs.FlagCreationForm.$el,r(s).modal("hide");break}},addFlag:function(){let e=this.$refs.FlagCreationForm.$el;r(e).modal()},editFlag:function(e){this.editing_flag_id=e;let s=this.$refs.FlagEditForm.$el;r(s).modal()},deleteFlag:function(e){confirm("Are you sure you'd like to delete this flag?")&&a.fetch(`/api/v1/flags/${e}`,{method:"DELETE"}).then(s=>s.json()).then(s=>{s.success&&this.loadFlags()})}},created(){this.loadFlags()}},De={id:"flagsboard",class:"table table-striped"},Le=t("thead",null,[t("tr",null,[t("td",{class:"text-center"},[t("b",null,"Type")]),t("td",{class:"text-center"},[t("b",null,"Flag")]),t("td",{class:"text-center"},[t("b",null,"Settings")])])],-1),Ve=["name"],Ie={class:"text-center"},Oe={class:"text-break"},Ge={class:"flag-content"},ze={class:"text-center"},Pe=["flag-id","flag-type","onClick"],Ue=["flag-id","onClick"],Je={class:"col-md-12"};function Me(e,s,l,u,o,i){const n=k("FlagCreationForm"),m=k("FlagEditForm");return d(),c("div",null,[t("div",null,[w(n,{ref:"FlagCreationForm",challenge_id:l.challenge_id,onRefreshFlags:i.refreshFlags},null,8,["challenge_id","onRefreshFlags"])]),t("div",null,[w(m,{ref:"FlagEditForm",flag_id:e.editing_flag_id,onRefreshFlags:i.refreshFlags},null,8,["flag_id","onRefreshFlags"])]),t("table",De,[Le,t("tbody",null,[(d(!0),c(v,null,b(e.flags,h=>(d(),c("tr",{name:h.id,key:h.id},[t("td",Ie,p(h.type),1),t("td",Oe,[t("pre",Ge,p(h.content),1)]),t("td",ze,[t("i",{role:"button",class:"btn-fa fas fa-edit edit-flag","flag-id":h.id,"flag-type":h.type,onClick:q=>i.editFlag(h.id)},null,8,Pe),t("i",{role:"button",class:"btn-fa fas fa-times delete-flag","flag-id":h.id,onClick:q=>i.deleteFlag(h.id)},null,8,Ue)])],8,Ve))),128))])]),t("div",Je,[t("button",{id:"flag-add-button",class:"btn btn-success d-inline-block float-right",onClick:s[0]||(s[0]=h=>i.addFlag())}," Create Flag ")])])}const Be=_(Ne,[["render",Me]]),Ke={props:{challenge_id:Number},data:function(){return{challenges:[],requirements:{},selectedRequirements:[],selectedAnonymize:!1}},computed:{newRequirements:function(){let e=this.requirements.prerequisites||[],s=this.requirements.anonymize||!1,l=JSON.stringify(e.sort())!==JSON.stringify(this.selectedRequirements.sort()),u=s!==this.selectedAnonymize;return l||u},requiredChallenges:function(){const e=this.requirements.prerequisites||[];return this.challenges.filter(s=>s.id!==this.$props.challenge_id&&e.includes(s.id))},otherChallenges:function(){const e=this.requirements.prerequisites||[];return this.challenges.filter(s=>s.id!==this.$props.challenge_id&&!e.includes(s.id))}},methods:{loadChallenges:function(){a.fetch("/api/v1/challenges?view=admin",{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success&&(this.challenges=e.data)})},getChallengeNameById:function(e){let s=this.challenges.find(l=>l.id===e);return s?s.name:""},loadRequirements:function(){a.fetch(`/api/v1/challenges/${this.$props.challenge_id}/requirements`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success&&(this.requirements=e.data||{},this.selectedRequirements=this.requirements.prerequisites||[],this.selectedAnonymize=this.requirements.anonymize||!1)})},updateRequirements:function(){const s={requirements:{prerequisites:this.selectedRequirements}};this.selectedAnonymize&&(s.requirements.anonymize=!0),a.fetch(`/api/v1/challenges/${this.$props.challenge_id}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(l=>l.json()).then(l=>{l.success&&this.loadRequirements()})}},created(){this.loadChallenges(),this.loadRequirements()}},A=e=>(U("data-v-a3fa86b4"),e=e(),J(),e),Ye={class:"form-group scrollbox"},Qe={class:"form-check-label cursor-pointer"},Ze=["value"],We={class:"form-check-label cursor-pointer"},Xe=["value"],et={class:"form-group"},tt=A(()=>t("label",null,[t("b",null,"Behavior if not unlocked")],-1)),st=A(()=>t("option",{value:!1},"Hidden",-1)),nt=A(()=>t("option",{value:!0},"Anonymized",-1)),it=[st,nt],lt={class:"form-group"},ot=["disabled"];function at(e,s,l,u,o,i){return d(),c("div",null,[t("form",{onSubmit:s[3]||(s[3]=H((...n)=>i.updateRequirements&&i.updateRequirements(...n),["prevent"]))},[t("div",Ye,[w(P,{name:"flip-list"},{default:z(()=>[(d(!0),c(v,null,b(i.requiredChallenges,n=>(d(),c("div",{class:"form-check",key:n.id},[t("label",Qe,[f(t("input",{class:"form-check-input",type:"checkbox",value:n.id,"onUpdate:modelValue":s[0]||(s[0]=m=>e.selectedRequirements=m)},null,8,Ze),[[j,e.selectedRequirements]]),g(" "+p(n.name),1)])]))),128)),(d(!0),c(v,null,b(i.otherChallenges,n=>(d(),c("div",{class:"form-check",key:n.id},[t("label",We,[f(t("input",{class:"form-check-input",type:"checkbox",value:n.id,"onUpdate:modelValue":s[1]||(s[1]=m=>e.selectedRequirements=m)},null,8,Xe),[[j,e.selectedRequirements]]),g(" "+p(n.name),1)])]))),128))]),_:1})]),t("div",et,[tt,f(t("select",{class:"form-control custom-select",name:"anonymize","onUpdate:modelValue":s[2]||(s[2]=n=>e.selectedAnonymize=n)},it,512),[[S,e.selectedAnonymize]])]),t("div",lt,[t("button",{class:"btn btn-success float-right",disabled:!i.newRequirements}," Save ",8,ot)])],32)])}const dt=_(Ke,[["render",at],["__scopeId","data-v-a3fa86b4"]]),ct={props:{challenge_id:Number},data:function(){return{topics:[],topicValue:"",searchedTopic:"",topicResults:[],selectedResultIdx:0,awaitingSearch:!1}},methods:{loadTopics:function(){a.fetch(`/api/v1/challenges/${this.$props.challenge_id}/topics`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success&&(this.topics=e.data)})},searchTopics:function(){if(this.selectedResultIdx=0,this.topicValue==""){this.topicResults=[];return}a.fetch(`/api/v1/topics?field=value&q=${this.topicValue}`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success&&(this.topicResults=e.data.slice(0,10))})},addTopic:function(){let e;if(this.selectedResultIdx===0)e=this.topicValue;else{let l=this.selectedResultIdx-1;e=this.topicResults[l].value}const s={value:e,challenge:this.$props.challenge_id,type:"challenge"};a.fetch("/api/v1/topics",{method:"POST",body:JSON.stringify(s)}).then(l=>l.json()).then(l=>{l.success&&(this.topicValue="",this.loadTopics())})},deleteTopic:function(e){a.fetch(`/api/v1/topics?type=challenge&target_id=${e}`,{method:"DELETE"}).then(s=>s.json()).then(s=>{s.success&&this.loadTopics()})},moveCursor:function(e){switch(e){case"up":this.selectedResultIdx&&(this.selectedResultIdx-=1);break;case"down":this.selectedResultIdx<this.topicResults.length&&(this.selectedResultIdx+=1);break}},selectTopic:function(e){e===void 0&&(e=this.selectedResultIdx);let s=this.topicResults[e];this.topicValue=s.value}},watch:{topicValue:function(e){this.awaitingSearch===!1&&setTimeout(()=>{this.searchTopics(),this.awaitingSearch=!1},500),this.awaitingSearch=!0}},created(){this.loadTopics()}},rt={class:"col-md-12"},ut={id:"challenge-topics",class:"my-3"},ht={class:"mr-1"},mt=["onClick"],pt={class:"form-group"},ft=t("label",null,[g(" Topic "),t("br"),t("small",{class:"text-muted"},"Type topic and press Enter")],-1),gt={class:"form-group"},_t={class:"list-group"},vt=["onClick"];function bt(e,s,l,u,o,i){return d(),c("div",rt,[t("div",ut,[(d(!0),c(v,null,b(e.topics,n=>(d(),c("h5",{class:"challenge-tag",key:n.id},[t("span",ht,p(n.value),1),t("a",{class:"btn-fa delete-tag",onClick:m=>i.deleteTopic(n.id)}," ×",8,mt)]))),128))]),t("div",pt,[ft,f(t("input",{id:"tags-add-input",maxlength:"255",type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=n=>e.topicValue=n),onKeyup:[s[1]||(s[1]=E(n=>i.moveCursor("down"),["down"])),s[2]||(s[2]=E(n=>i.moveCursor("up"),["up"])),s[3]||(s[3]=E(n=>i.addTopic(),["enter"]))]},null,544),[[F,e.topicValue]])]),t("div",gt,[t("ul",_t,[(d(!0),c(v,null,b(e.topicResults,(n,m)=>(d(),c("li",{class:M({"list-group-item":!0,active:m+1===e.selectedResultIdx}),key:n.id,onClick:h=>i.selectTopic(m)},p(n.value),11,vt))),128))])])])}const $t=_(ct,[["render",bt]]),yt={props:{challenge_id:Number},data:function(){return{tags:[],tagValue:""}},methods:{loadTags:function(){a.fetch(`/api/v1/challenges/${this.$props.challenge_id}/tags`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success&&(this.tags=e.data)})},addTag:function(){if(this.tagValue){const e={value:this.tagValue,challenge:this.$props.challenge_id};a.api.post_tag_list({},e).then(s=>{s.success&&(this.tagValue="",this.loadTags())})}},deleteTag:function(e){a.api.delete_tag({tagId:e}).then(s=>{s.success&&this.loadTags()})}},created(){this.loadTags()}},Ct={class:"col-md-12"},Ft={id:"challenge-tags",class:"my-3"},Tt=["onClick"],wt={class:"form-group"},Ht=t("label",null,[g("Tag "),t("br"),t("small",{class:"text-muted"},"Type tag and press Enter")],-1);function Et(e,s,l,u,o,i){return d(),c("div",Ct,[t("div",Ft,[(d(!0),c(v,null,b(e.tags,n=>(d(),c("span",{class:"badge badge-primary mx-1 challenge-tag",key:n.id},[t("span",null,p(n.value),1),t("a",{class:"btn-fa delete-tag",onClick:m=>i.deleteTag(n.id)}," ×",8,Tt)]))),128))]),t("div",wt,[Ht,f(t("input",{id:"tags-add-input",maxlength:"80",type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=n=>e.tagValue=n),onKeyup:s[1]||(s[1]=E(n=>i.addTag(),["enter"]))},null,544),[[F,e.tagValue]])])])}const kt=_(yt,[["render",Et]]),jt={props:{challenge_id:Number},data:function(){return{files:[],urlRoot:a.config.urlRoot}},methods:{loadFiles:function(){a.fetch(`/api/v1/challenges/${this.$props.challenge_id}/files`,{method:"GET"}).then(e=>e.json()).then(e=>{e.success&&(this.files=e.data)})},addFiles:function(){let e={challenge:this.$props.challenge_id,type:"challenge"},s=this.$refs.FileUploadForm;V.files.upload(s,e,l=>{setTimeout(()=>{this.loadFiles()},700)})},deleteFile:function(e){x({title:"Delete Files",body:"Are you sure you want to delete this file?",success:()=>{a.fetch(`/api/v1/files/${e}`,{method:"DELETE"}).then(s=>s.json()).then(s=>{s.success&&this.loadFiles()})}})}},created(){this.loadFiles()}},xt={id:"filesboard",class:"table table-striped"},St=t("thead",null,[t("tr",null,[t("td",{class:"text-center"},[t("b",null,"File")]),t("td",{class:"text-center"},[t("b",null,"Settings")])])],-1),qt={class:"text-left"},At=["href"],Rt={class:"d-flex flex-row align-items-center"},Nt=t("strong",{class:"mr-2 small"}," SHA1: ",-1),Dt={class:"d-inline-block mr-2 small text-muted"},Lt={class:"text-center"},Vt=["onClick"],It={class:"col-md-12 mt-3"},Ot=T('<div class="form-group"><input class="form-control-file" id="file" multiple="" name="file" required="" type="file"><sub class="text-muted"> Attach multiple files using Control+Click or Cmd+Click. </sub></div><div class="form-group"><input class="btn btn-success float-right" id="_submit" name="_submit" type="submit" value="Upload"></div>',2),Gt=[Ot];function zt(e,s,l,u,o,i){return d(),c("div",null,[t("table",xt,[St,t("tbody",null,[(d(!0),c(v,null,b(e.files,n=>(d(),c("tr",{key:n.id},[t("td",qt,[t("a",{href:`${e.urlRoot}/files/${n.location}`},p(n.location.split("/").pop()),9,At),t("div",Rt,[Nt,t("span",Dt,p(n.sha1sum||"null"),1)])]),t("td",Lt,[t("i",{role:"button",class:"btn-fa fas fa-times delete-file",onClick:m=>i.deleteFile(n.id)},null,8,Vt)])]))),128))])]),t("div",It,[t("form",{method:"POST",ref:"FileUploadForm",onSubmit:s[0]||(s[0]=H((...n)=>i.addFiles&&i.addFiles(...n),["prevent"]))},Gt,544)])])}const Pt=_(jt,[["render",zt]]),Ut={name:"HintCreationForm",props:{challenge_id:Number,hints:Array},data:function(){return{cost:0,selectedHints:[]}},methods:{getCost:function(){return this.cost||0},getContent:function(){return this.$refs.content.value},getTitle:function(){return this.$refs.title.value},submitHint:function(){let e={challenge_id:this.$props.challenge_id,content:this.getContent(),cost:this.getCost(),title:this.getTitle(),requirements:{prerequisites:this.selectedHints}};CTFd.fetch("/api/v1/hints",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(s=>s.json()).then(s=>{s.success&&this.$emit("refreshHints",this.$options.name)})}}},Jt={class:"modal fade",tabindex:"-1"},Mt={class:"modal-dialog"},Bt={class:"modal-content"},Kt=T('<div class="modal-header text-center"><div class="container"><div class="row"><div class="col-md-12"><h3>Hint</h3></div></div></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>',1),Yt={class:"modal-body"},Qt={class:"container"},Zt={class:"row"},Wt={class:"col-md-12"},Xt={class:"form-group"},es=t("label",null,[g(" Title"),t("br"),t("small",null,"Content displayed before hint unlocking")],-1),ts={type:"text",class:"form-control",name:"title",ref:"title"},ss={class:"form-group"},ns=t("label",null,[g(" Hint"),t("br"),t("small",null,"Markdown & HTML are supported")],-1),is={type:"text",class:"form-control markdown",name:"content",rows:"7",ref:"content"},ls={class:"form-group"},os=t("label",null,[g(" Cost"),t("br"),t("small",null,"How many points it costs to see your hint.")],-1),as={class:"form-group"},ds=t("label",null,[g(" Requirements"),t("br"),t("small",null,"Hints that must be unlocked before unlocking this hint")],-1),cs={class:"form-check-label cursor-pointer"},rs=["value"],us=t("input",{type:"hidden",id:"hint-id-for-hint",name:"id"},null,-1),hs=T('<div class="modal-footer"><div class="container"><div class="row"><div class="col-md-12"><button class="btn btn-primary float-right">Submit</button></div></div></div></div>',1);function ms(e,s,l,u,o,i){return d(),c("div",Jt,[t("div",Mt,[t("div",Bt,[Kt,t("form",{method:"POST",onSubmit:s[2]||(s[2]=H((...n)=>i.submitHint&&i.submitHint(...n),["prevent"]))},[t("div",Yt,[t("div",Qt,[t("div",Zt,[t("div",Wt,[t("div",Xt,[es,t("input",ts,null,512)]),t("div",ss,[ns,t("textarea",is,null,512)]),t("div",ls,[os,f(t("input",{type:"number",class:"form-control",name:"cost","onUpdate:modelValue":s[0]||(s[0]=n=>e.cost=n)},null,512),[[F,e.cost,void 0,{lazy:!0}]])]),t("div",as,[ds,(d(!0),c(v,null,b(l.hints,n=>(d(),c("div",{class:"form-check",key:n.id},[t("label",cs,[f(t("input",{class:"form-check-input",type:"checkbox",value:n.id,"onUpdate:modelValue":s[1]||(s[1]=m=>e.selectedHints=m)},null,8,rs),[[j,e.selectedHints]]),g(" "+p(n.cost)+" - "+p(n.id),1)])]))),128))]),us])])])]),hs],32)])])])}const ps=_(Ut,[["render",ms]]),fs={name:"HintEditForm",props:{challenge_id:Number,hint_id:Number,hints:Array},data:function(){return{cost:0,title:null,content:null,selectedHints:[]}},computed:{otherHints:function(){return this.hints.filter(e=>e.id!==this.$props.hint_id)}},watch:{hint_id:{immediate:!0,handler(e,s){e!==null&&this.loadHint()}}},methods:{loadHint:function(){a.fetch(`/api/v1/hints/${this.$props.hint_id}?preview=true`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{var s;if(e.success){let l=e.data;this.cost=l.cost,this.title=l.title,this.content=l.content,this.selectedHints=((s=l.requirements)==null?void 0:s.prerequisites)||[];let u=this.$refs.content;B(u),setTimeout(()=>{u.mde.codemirror.getDoc().setValue(u.value),this._forceRefresh()},200)}})},_forceRefresh:function(){this.$refs.content.mde.codemirror.refresh()},getCost:function(){return this.cost||0},getContent:function(){return this._forceRefresh(),this.$refs.content.mde.codemirror.getDoc().getValue()},getTitle:function(){return this.$refs.title.value},updateHint:function(){let e={challenge_id:this.$props.challenge_id,content:this.getContent(),cost:this.getCost(),title:this.getTitle(),requirements:{prerequisites:this.selectedHints}};a.fetch(`/api/v1/hints/${this.$props.hint_id}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(s=>s.json()).then(s=>{s.success&&this.$emit("refreshHints",this.$options.name)})}},mounted(){this.hint_id&&this.loadHint()},created(){this.hint_id&&this.loadHint()}},gs={class:"modal fade",tabindex:"-1"},_s={class:"modal-dialog"},vs={class:"modal-content"},bs=T('<div class="modal-header text-center"><div class="container"><div class="row"><div class="col-md-12"><h3>Hint</h3></div></div></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>',1),$s={class:"modal-body"},ys={class:"container"},Cs={class:"row"},Fs={class:"col-md-12"},Ts={class:"form-group"},ws=t("label",null,[g(" Title"),t("br"),t("small",null,"Content displayed before hint unlocking")],-1),Hs=["value"],Es={class:"form-group"},ks=t("label",null,[g(" Hint"),t("br"),t("small",null,"Markdown & HTML are supported")],-1),js=["value"],xs={class:"form-group"},Ss=t("label",null,[g(" Cost"),t("br"),t("small",null,"How many points it costs to see your hint.")],-1),qs={class:"form-group"},As=t("label",null,[g(" Requirements"),t("br"),t("small",null,"Hints that must be unlocked before unlocking this hint")],-1),Rs={class:"form-check-label cursor-pointer"},Ns=["value"],Ds=T('<div class="modal-footer"><div class="container"><div class="row"><div class="col-md-12"><button class="btn btn-primary float-right">Submit</button></div></div></div></div>',1);function Ls(e,s,l,u,o,i){return d(),c("div",gs,[t("div",_s,[t("div",vs,[bs,t("form",{method:"POST",onSubmit:s[2]||(s[2]=H((...n)=>i.updateHint&&i.updateHint(...n),["prevent"]))},[t("div",$s,[t("div",ys,[t("div",Cs,[t("div",Fs,[t("div",Ts,[ws,t("input",{type:"text",class:"form-control",name:"title",value:this.title,ref:"title"},null,8,Hs)]),t("div",Es,[ks,t("textarea",{type:"text",class:"form-control",name:"content",rows:"7",value:this.content,ref:"content"},null,8,js)]),t("div",xs,[Ss,f(t("input",{type:"number",class:"form-control",name:"cost","onUpdate:modelValue":s[0]||(s[0]=n=>e.cost=n)},null,512),[[F,e.cost,void 0,{lazy:!0}]])]),t("div",qs,[As,(d(!0),c(v,null,b(i.otherHints,n=>(d(),c("div",{class:"form-check",key:n.id},[t("label",Rs,[f(t("input",{class:"form-check-input",type:"checkbox",value:n.id,"onUpdate:modelValue":s[1]||(s[1]=m=>e.selectedHints=m)},null,8,Ns),[[j,e.selectedHints]]),g(" "+p(n.content)+" - "+p(n.cost),1)])]))),128))])])])])]),Ds],32)])])])}const Vs=_(fs,[["render",Ls]]),Is={components:{HintCreationForm:ps,HintEditForm:Vs},props:{challenge_id:Number},data:function(){return{hints:[],editing_hint_id:null}},methods:{loadHints:async function(){let s=await(await a.fetch(`/api/v1/challenges/${this.$props.challenge_id}/hints`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}})).json();return this.hints=s.data,s.success},addHint:function(){let e=this.$refs.HintCreationForm.$el;$(e).modal()},editHint:function(e){this.editing_hint_id=e;let s=this.$refs.HintEditForm.$el;$(s).modal()},refreshHints:function(e){this.loadHints().then(s=>{if(s){let l;switch(e){case"HintCreationForm":l=this.$refs.HintCreationForm.$el,console.log(l),$(l).modal("hide");break;case"HintEditForm":l=this.$refs.HintEditForm.$el,$(l).modal("hide");break}}else alert("An error occurred while updating this hint. Please try again.")})},deleteHint:function(e){x({title:"Delete Hint",body:"Are you sure you want to delete this hint?",success:()=>{a.fetch(`/api/v1/hints/${e}`,{method:"DELETE"}).then(s=>s.json()).then(s=>{s.success&&this.loadHints()})}})}},created(){this.loadHints()}},Os={class:"table table-striped"},Gs=t("thead",null,[t("tr",null,[t("td",{class:"text-center"},[t("b",null,"ID")]),t("td",{class:"text-center"},[t("b",null,"Title")]),t("td",{class:"text-center"},[t("b",null,"Hint")]),t("td",{class:"text-center"},[t("b",null,"Cost")]),t("td",{class:"text-center"},[t("b",null,"Settings")])])],-1),zs={class:"text-center"},Ps={class:"text-center"},Us={class:"text-break"},Js={class:"text-center"},Ms={class:"text-center"},Bs=["onClick"],Ks=["onClick"],Ys={class:"col-md-12"};function Qs(e,s,l,u,o,i){const n=k("HintCreationForm"),m=k("HintEditForm");return d(),c("div",null,[t("div",null,[w(n,{ref:"HintCreationForm",challenge_id:l.challenge_id,hints:e.hints,onRefreshHints:i.refreshHints},null,8,["challenge_id","hints","onRefreshHints"])]),t("div",null,[w(m,{ref:"HintEditForm",challenge_id:l.challenge_id,hint_id:e.editing_hint_id,hints:e.hints,onRefreshHints:i.refreshHints},null,8,["challenge_id","hint_id","hints","onRefreshHints"])]),t("table",Os,[Gs,t("tbody",null,[(d(!0),c(v,null,b(e.hints,h=>(d(),c("tr",{key:h.id},[t("td",zs,p(h.type),1),t("td",Ps,p(h.title),1),t("td",Us,[t("pre",null,p(h.content),1)]),t("td",Js,p(h.cost),1),t("td",Ms,[t("i",{role:"button",class:"btn-fa fas fa-edit",onClick:q=>i.editHint(h.id)},null,8,Bs),t("i",{role:"button",class:"btn-fa fas fa-times",onClick:q=>i.deleteHint(h.id)},null,8,Ks)])]))),128))])]),t("div",Ys,[t("button",{class:"btn btn-success float-right",onClick:s[0]||(s[0]=(...h)=>i.addHint&&i.addHint(...h))}," Create Hint ")])])}const Zs=_(Is,[["render",Qs]]),Ws={props:{challenge_id:Number},data:function(){return{challenge:null,challenges:[],selected_id:null}},computed:{updateAvailable:function(){return this.challenge?this.selected_id!=this.challenge.next_id:!1},otherChallenges:function(){return this.challenges.filter(e=>e.id!==this.$props.challenge_id)}},methods:{loadData:function(){a.fetch(`/api/v1/challenges/${this.$props.challenge_id}`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success&&(this.challenge=e.data,this.selected_id=e.data.next_id)})},loadChallenges:function(){a.fetch("/api/v1/challenges?view=admin",{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success&&(this.challenges=e.data)})},updateNext:function(){a.fetch(`/api/v1/challenges/${this.$props.challenge_id}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({next_id:this.selected_id!="null"?this.selected_id:null})}).then(e=>e.json()).then(e=>{e.success&&(this.loadData(),this.loadChallenges())})}},created(){this.loadData(),this.loadChallenges()}},Xs={class:"form-group"},en=t("label",null,[g(" Next Challenge "),t("br"),t("small",{class:"text-muted"},"Challenge to recommend after solving this challenge")],-1),tn=t("option",{value:"null"},"--",-1),sn=["value"],nn={class:"form-group"},ln=["disabled"];function on(e,s,l,u,o,i){return d(),c("div",null,[t("form",{onSubmit:s[1]||(s[1]=H((...n)=>i.updateNext&&i.updateNext(...n),["prevent"]))},[t("div",Xs,[en,f(t("select",{class:"form-control custom-select","onUpdate:modelValue":s[0]||(s[0]=n=>e.selected_id=n)},[tn,(d(!0),c(v,null,b(i.otherChallenges,n=>(d(),c("option",{value:n.id,key:n.id},p(n.name),9,sn))),128))],512),[[S,e.selected_id]])]),t("div",nn,[t("button",{class:"btn btn-success float-right",disabled:!i.updateAvailable}," Save ",8,ln)])],32)])}const an=_(Ws,[["render",on]]);function R(e){a._internal.challenge={},r.getScript(a.config.urlRoot+e.scripts.view,function(){let s=e.create;r("#create-chal-entry-div").html(s),Q(),r.getScript(a.config.urlRoot+e.scripts.create,function(){r("#create-chal-entry-div form").submit(function(l){l.preventDefault();const u=r("#create-chal-entry-div form").serializeJSON();a.fetch("/api/v1/challenges",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(u)}).then(function(o){return o.json()}).then(function(o){if(o.success)r("#challenge-create-options #challenge_id").val(o.data.id),r("#challenge-create-options").modal();else{let i="";for(const n in o.errors)i+=o.errors[n].join(`
`),i+=`
`;I({title:"Error",body:i,button:"OK"})}})})})})}function dn(e){e.preventDefault();var s=r(e.target).serializeJSON(!0);let l={challenge_id:s.challenge_id,content:s.flag||"",type:s.flag_type,data:s.flag_data?s.flag_data:""},u=function(){a.fetch("/api/v1/challenges/"+s.challenge_id,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({state:s.state})}).then(function(o){return o.json()}).then(function(o){o.success&&setTimeout(function(){window.location=a.config.urlRoot+"/admin/challenges/"+s.challenge_id},700)})};Promise.all([new Promise(function(o,i){if(l.content.length==0){o();return}a.fetch("/api/v1/flags",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)}).then(function(n){o(n.json())})}),new Promise(function(o,i){let n=e.target,m={challenge:s.challenge_id,type:"challenge"};r(n.elements.file).val()&&V.files.upload(n,m),o()})]).then(o=>{u()})}r(()=>{if(r(".preview-challenge").click(function(e){let s=`${a.config.urlRoot}/admin/challenges/preview/${window.CHALLENGE_ID}`;r("#challenge-window").html(`<iframe src="${s}" height="100%" width="100%" frameBorder=0></iframe>`),r("#challenge-modal").modal()}),r(".comments-challenge").click(function(e){r("#challenge-comments-window").modal()}),r(".delete-challenge").click(function(e){x({title:"Delete Challenge",body:`Are you sure you want to delete <strong>${K(window.CHALLENGE_NAME)}</strong>`,success:function(){a.fetch("/api/v1/challenges/"+window.CHALLENGE_ID,{method:"DELETE"}).then(function(s){return s.json()}).then(function(s){s.success&&(window.location=a.config.urlRoot+"/admin/challenges")})}})}),r("#challenge-update-container > form").submit(function(e){e.preventDefault();var s=r(e.target).serializeJSON(!0);a.fetch("/api/v1/challenges/"+window.CHALLENGE_ID+"/flags",{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(l){return l.json()}).then(function(l){let u=function(){a.fetch("/api/v1/challenges/"+window.CHALLENGE_ID,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(o){return o.json()}).then(function(o){if(o.success){switch(r(".challenge-state").text(o.data.state),o.data.state){case"visible":r(".challenge-state").removeClass("badge-danger").addClass("badge-success");break;case"hidden":r(".challenge-state").removeClass("badge-success").addClass("badge-danger");break}Y({title:"Success",body:"Your challenge has been updated!"})}else{let i="";for(const n in o.errors)i+=o.errors[n].join(`
`),i+=`
`;I({title:"Error",body:i,button:"OK"})}})};l.data.length===0&&s.state==="visible"?x({title:"Missing Flags",body:"This challenge does not have any flags meaning it may be unsolveable. Are you sure you'd like to update this challenge?",success:u}):u()})}),r("#challenge-create-options form").submit(dn),document.querySelector("#challenge-flags")){let e=document.createElement("div");document.querySelector("#challenge-flags").appendChild(e),y({render:()=>C(Be,{challenge_id:window.CHALLENGE_ID})}).mount(e)}if(document.querySelector("#challenge-topics")){let e=document.createElement("div");document.querySelector("#challenge-topics").appendChild(e),y({render:()=>C($t,{challenge_id:window.CHALLENGE_ID})}).mount(e)}if(document.querySelector("#challenge-tags")){let e=document.createElement("div");document.querySelector("#challenge-tags").appendChild(e),y({render:()=>C(kt,{challenge_id:window.CHALLENGE_ID})}).mount(e)}if(document.querySelector("#prerequisite-add-form")){let e=document.createElement("div");document.querySelector("#prerequisite-add-form").appendChild(e),y({render:()=>C(dt,{challenge_id:window.CHALLENGE_ID})}).mount(e)}if(document.querySelector("#challenge-files")){let e=document.createElement("div");document.querySelector("#challenge-files").appendChild(e),y({render:()=>C(Pt,{challenge_id:window.CHALLENGE_ID})}).mount(e)}if(document.querySelector("#challenge-hints")){let e=document.createElement("div");document.querySelector("#challenge-hints").appendChild(e),y({render:()=>C(Zs,{challenge_id:window.CHALLENGE_ID})}).mount(e)}if(document.querySelector("#next-add-form")){let e=document.createElement("div");document.querySelector("#next-add-form").appendChild(e),y({render:()=>C(an,{challenge_id:window.CHALLENGE_ID})}).mount(e)}if(document.querySelector("#comment-box")){let e=document.createElement("div");document.querySelector("#comment-box").appendChild(e),y({render:()=>C(Z,{challenge_id:window.CHALLENGE_ID})}).mount(e)}r.get(a.config.urlRoot+"/api/v1/challenges/types",function(e){const s=e.data;R(s.standard),r("#create-chals-select input[name=type]").change(function(){let l=s[this.value];R(l)})})});
